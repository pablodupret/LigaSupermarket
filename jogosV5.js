// ========================
// Dados dos jogos – Dia 1
// ========================
const jogosDia1 = [
    { dia: 1, rodada: 1, jogador1: "Eduardo", resultado: "1 x 2", jogador2: "Magno" },
    { dia: 1, rodada: 1, jogador1: "Igor", resultado: "0 x 2", jogador2: "Joca" },
    { dia: 1, rodada: 1, jogador1: "Marcelo", resultado: "2 x 1", jogador2: "Stenio" },
    { dia: 1, rodada: 1, jogador1: "Alex", resultado: "2 x 0", jogador2: "Pablo" },
    { dia: 1, rodada: 1, jogador1: "Nagib", resultado: "2 x 0", jogador2: "Subzero" },
    { dia: 1, rodada: 1, jogador1: "Sérgio", resultado: "2 x 0", jogador2: "Bye" },
  
    { dia: 1, rodada: 2, jogador1: "Magno", resultado: "2 x 1", jogador2: "Nagib" },
    { dia: 1, rodada: 2, jogador1: "Joca", resultado: "0 x 2", jogador2: "Sérgio" },
    { dia: 1, rodada: 2, jogador1: "Eduardo", resultado: "2 x 0", jogador2: "Subzero" },
    { dia: 1, rodada: 2, jogador1: "Igor", resultado: "1 x 1", jogador2: "Pablo" },
    { dia: 1, rodada: 2, jogador1: "Alex", resultado: "1 x 2", jogador2: "Marcelo" },
    { dia: 1, rodada: 2, jogador1: "Stenio", resultado: "2 x 0", jogador2: "Bye" },
  
    { dia: 1, rodada: 3, jogador1: "Magno", resultado: "2 x 0", jogador2: "Stenio" },
    { dia: 1, rodada: 3, jogador1: "Joca", resultado: "2 x 0", jogador2: "Pablo" },
    { dia: 1, rodada: 3, jogador1: "Marcelo", resultado: "2 x 0", jogador2: "Sérgio" },
    { dia: 1, rodada: 3, jogador1: "Alex", resultado: "2 x 0", jogador2: "Eduardo" },
    { dia: 1, rodada: 3, jogador1: "Igor", resultado: "0 x 2", jogador2: "Nagib" },
    { dia: 1, rodada: 3, jogador1: "Subzero", resultado: "2 x 0", jogador2: "Bye" },
  
    { dia: 1, rodada: 4, jogador1: "Magno", resultado: "2 x 0", jogador2: "Marcelo" },
    { dia: 1, rodada: 4, jogador1: "Nagib", resultado: "2 x 0", jogador2: "Sérgio" },
    { dia: 1, rodada: 4, jogador1: "Alex", resultado: "2 x 1", jogador2: "Joca" },
    { dia: 1, rodada: 4, jogador1: "Eduardo", resultado: "1 x 2", jogador2: "Stenio" },
    { dia: 1, rodada: 4, jogador1: "Igor", resultado: "0 x 2", jogador2: "Subzero" },
    { dia: 1, rodada: 4, jogador1: "Pablo", resultado: "2 x 0", jogador2: "Bye" }
  ]
  
  // ========================
  // Dados dos jogos – Dia 2
  // ========================
  const jogosDia2 = [
    { dia: 2, rodada: 1, jogador1: "Magno", resultado: "2 x 0", jogador2: "Qiu" },
    { dia: 2, rodada: 1, jogador1: "Nagib", resultado: "2 x 1", jogador2: "Vinicios" },
    { dia: 2, rodada: 1, jogador1: "Pablo", resultado: "0 x 2", jogador2: "Eduardo" },
    { dia: 2, rodada: 1, jogador1: "Stenio", resultado: "2 x 0", jogador2: "Bye" },
  
    { dia: 2, rodada: 2, jogador1: "Magno", resultado: "2 x 0", jogador2: "Stenio" },
    { dia: 2, rodada: 2, jogador1: "Eduardo", resultado: "2 x 1", jogador2: "Nagib" },
    { dia: 2, rodada: 2, jogador1: "Pablo", resultado: "1 x 1", jogador2: "Vinicios" },
    { dia: 2, rodada: 2, jogador1: "Qiu", resultado: "2 x 0", jogador2: "Bye" },
  
    { dia: 2, rodada: 3, jogador1: "Magno", resultado: "2 x 0", jogador2: "Eduardo" },
    { dia: 2, rodada: 3, jogador1: "Qiu", resultado: "2 x 0", jogador2: "Vinicios" },
    { dia: 2, rodada: 3, jogador1: "Nagib", resultado: "1 x 1", jogador2: "Stenio" },
    { dia: 2, rodada: 3, jogador1: "Pablo", resultado: "2 x 0", jogador2: "Bye" }
  ]
  
  
  const jogosDia3 = [
    // Primeira Rodada
    { dia: 3, rodada: 1, jogador1: "Magno", resultado: "1 x 0", jogador2: "Nagib" },
    { dia: 3, rodada: 1, jogador1: "Stenio", resultado: "2 x 0", jogador2: "Pablo" },
    { dia: 3, rodada: 1, jogador1: "Marcelo", resultado: "1 x 2", jogador2: "Joca" },
    { dia: 3, rodada: 1, jogador1: "Eduardo", resultado: "1 x 1", jogador2: "Sergio" },
    { dia: 3, rodada: 1, jogador1: "Caio", resultado: "1 x 1", jogador2: "Jun" },
    { dia: 3, rodada: 1, jogador1: "Alex", resultado: "2 x 0", jogador2: "Bye" },
  
    // Segunda Rodada
    { dia: 3, rodada: 2, jogador1: "Alex", resultado: "0 x 2", jogador2: "Joca" },
    { dia: 3, rodada: 2, jogador1: "Magno", resultado: "2 x 0", jogador2: "Stenio" },
    { dia: 3, rodada: 2, jogador1: "Eduardo", resultado: "2 x 0", jogador2: "Caio" },
    { dia: 3, rodada: 2, jogador1: "Jun", resultado: "2 x 0", jogador2: "Sergio" },
    { dia: 3, rodada: 2, jogador1: "Nagib", resultado: "2 x 0", jogador2: "Marcelo" },
    { dia: 3, rodada: 2, jogador1: "Pablo", resultado: "2 x 0", jogador2: "Bye" },
  
    // Terceira Rodada
    { dia: 3, rodada: 3, jogador1: "Magno", resultado: "2 x 1", jogador2: "Joca" },
    { dia: 3, rodada: 3, jogador1: "Eduardo", resultado: "0 x 2", jogador2: "Jun" },
    { dia: 3, rodada: 3, jogador1: "Nagib", resultado: "2 x 0", jogador2: "Caio" },
    { dia: 3, rodada: 3, jogador1: "Sergio", resultado: "0 x 2", jogador2: "Stenio" },
    { dia: 3, rodada: 3, jogador1: "Pablo", resultado: "1 x 2", jogador2: "Alex" },
    { dia: 3, rodada: 3, jogador1: "Marcelo", resultado: "2 x 0", jogador2: "Bye" },
  
    // Quarta Rodada
    { dia: 3, rodada: 4, jogador1: "Magno", resultado: "2 x 0", jogador2: "Jun" },
    { dia: 3, rodada: 4, jogador1: "Joca", resultado: "0 x 2", jogador2: "Nagib" },
    { dia: 3, rodada: 4, jogador1: "Stenio", resultado: "2 x 0", jogador2: "Alex" },
    { dia: 3, rodada: 4, jogador1: "Eduardo", resultado: "0 x 2", jogador2: "Marcelo" },
    { dia: 3, rodada: 4, jogador1: "Pablo", resultado: "0 x 2", jogador2: "Sergio" },
    { dia: 3, rodada: 4, jogador1: "Caio", resultado: "2 x 0", jogador2: "Bye" }
  ];
  
  
  
  // =============================
  // Geração dinâmica das rodadas
  // =============================
  function gerarTabelaPorRodada(jogos, containerId) {
    const container = document.getElementById(containerId)
    container.innerHTML = ""
  
    const rodadas = [...new Set(jogos.map(j => j.rodada))]
  
    rodadas.forEach(rodada => {
      const rodadaJogos = jogos.filter(j => j.rodada === rodada)
  
      let html = `<h3>Rodada ${rodada}</h3>`
      html += `<table>
        <thead>
          <tr>
            <th>Jogador 1</th>
            <th>Resultado</th>
            <th>Jogador 2</th>
          </tr>
        </thead>
        <tbody>`
  
      rodadaJogos.forEach(jogo => {
        html += `<tr>
          <td>${jogo.jogador1}</td>
          <td>${jogo.resultado}</td>
          <td>${jogo.jogador2}</td>
        </tr>`
      })
  
      html += `</tbody></table>`
      container.innerHTML += html
    })
  }
  
  // =====================
  // Estatísticas e Filtros
  // =====================
  function calcularEstatisticas(nome, jogos) {
    let vitorias = 0, derrotas = 0, empates = 0, total = 0
  
    jogos.forEach(jogo => {
      const [gols1, gols2] = jogo.resultado.split(" x ").map(Number)
  
      if (jogo.jogador1 === nome || jogo.jogador2 === nome) {
        total++
        if ((jogo.jogador1 === nome && gols1 > gols2) || (jogo.jogador2 === nome && gols2 > gols1)) {
          vitorias++
        } else if (gols1 === gols2) {
          empates++
        } else {
          derrotas++
        }
      }
    })
  
    return { vitorias, derrotas, empates, total }
  }
  
  function filtrarJogosPorJogador(nome) {
    const todosJogos = [...jogosDia1, ...jogosDia2, ...jogosDia3]
    const jogosFiltrados = todosJogos.filter(jogo =>
      jogo.jogador1 === nome || jogo.jogador2 === nome
    )
  
    document.getElementById("tabelas-rodadas-dia1").style.display = "none"
    document.getElementById("tabelas-rodadas-dia2").style.display = "none"
  
    const container = document.getElementById("jogos-filtrados")
    container.innerHTML = `<h2>Jogos de ${nome}</h2>`
    gerarListaSimples(jogosFiltrados, "jogos-filtrados")
  
    const stats = calcularEstatisticas(nome, todosJogos)
    const statBox = document.getElementById("estatisticas")
    statBox.innerHTML = `
      <h3>Estatísticas de ${nome}</h3>
      <p>Partidas: <span id="contagem-total">0</span></p>
      <p>Vitórias: <span id="contagem-vitorias">0</span></p>
      <p>Derrotas: <span id="contagem-derrotas">0</span></p>
      <p>Empates: <span id="contagem-empates">0</span></p>
      <br>
      <button onclick="resetarTabela()"> Voltar Histórico Completo</button>
    `
  
    // Anima os números após atualizar o conteúdo
    setTimeout(() => {
      animarContagem("contagem-total", stats.total)
      animarContagem("contagem-vitorias", stats.vitorias)
      animarContagem("contagem-derrotas", stats.derrotas)
      animarContagem("contagem-empates", stats.empates)
    }, 100)
  }
  
  function filtrarJogos() {
    const nome = document.getElementById("filtro-jogador").value.trim()
    if (nome) filtrarJogosPorJogador(nome)
  }
  
  function resetarTabela() {
    gerarTabelaPorRodada(jogosDia1, "tabelas-rodadas-dia1")
    gerarTabelaPorRodada(jogosDia2, "tabelas-rodadas-dia2")
    document.getElementById("estatisticas").innerHTML = ""
    document.getElementById("jogos-filtrados").innerHTML = ""
    document.getElementById("tabelas-rodadas-dia1").style.display = "block"
    document.getElementById("tabelas-rodadas-dia2").style.display = "block"
  }
  
  // ==================
  // Inicialização
  // ==================
  window.addEventListener("DOMContentLoaded", () => {
    gerarTabelaPorRodada(jogosDia1, "tabelas-rodadas-dia1")
    gerarTabelaPorRodada(jogosDia2, "tabelas-rodadas-dia2")
  })
  
  //------------
  // Lista Simples para jogos filtrados
  //-----------
  function gerarListaSimples(jogos, containerId) {
    const container = document.getElementById(containerId)
    container.innerHTML = ""
  
    let html = `<table>
      <thead>
        <tr>
          <th> Dia </th>
          <th>Jogador 1</th>
          <th>Resultado</th>
          <th>Jogador 2</th>
        </tr>
      </thead>
      <tbody>`
  
    jogos.forEach(jogo => {
      html += `<tr>
        <td>${jogo.dia}</td>
        <td>${jogo.jogador1}</td>
        <td>${jogo.resultado}</td>
        <td>${jogo.jogador2}</td>
      </tr>`
    })
  
    html += `</tbody></table>`
    container.innerHTML = html
  }
  
  // ==================
  // Função de animação
  // ==================
  function animarContagem(id, valorFinal) {
    const elemento = document.getElementById(id)
    if (!elemento) return
  
    let valorAtual = 0
    const incremento = Math.ceil(valorFinal / 40) || 1
  
    const intervalo = setInterval(() => {
      valorAtual += incremento
      if (valorAtual >= valorFinal) {
        valorAtual = valorFinal
        clearInterval(intervalo)
      }
      elemento.innerText = valorAtual
    }, 60)
  }
  
  
  
  // ===========================
  // GERAÇÃO AUTOMÁTICA DO RANKING
  // ===========================
  function calcularRanking() {
  const todosJogos = [...jogosDia1, ...jogosDia2, ...jogosDia3];
  const pontuacoes = {};
  
  todosJogos.forEach(jogo => {
    const [g1, g2] = jogo.resultado.split(" x ").map(Number);
    const j1 = jogo.jogador1;
    const j2 = jogo.jogador2;
  
    if (!pontuacoes[j1]) pontuacoes[j1] = 0;
    if (!pontuacoes[j2]) pontuacoes[j2] = 0;
  
    if (g1 > g2) pontuacoes[j1] += 3;
    else if (g1 < g2) pontuacoes[j2] += 3;
    else {
      pontuacoes[j1] += 1;
      pontuacoes[j2] += 1;
    }
  });
  
  return Object.entries(pontuacoes)
    .map(([jogador, pontos]) => ({ jogador, pontos }))
    .sort((a, b) => b.pontos - a.pontos);
  }
  
  function exibirRanking() {
  const ranking = calcularRanking();
  const tabela = document.querySelector("table tbody");
  tabela.innerHTML = "";
  
  ranking.forEach((entry, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${index + 1}º</td>
      <td>${entry.jogador}</td>
      <td>${entry.pontos}</td>
    `;
    tabela.appendChild(tr);
  });
  }
  
  
  // ===========================
  // MELHORIAS: APROVEITAMENTO E ESTATÍSTICAS DA LIGA
  // ===========================
  
  function calcularEstatisticasCompletas(nome, jogos) {
  let vitorias = 0, derrotas = 0, empates = 0, total = 0
  
  jogos.forEach(jogo => {
    const [g1, g2] = jogo.resultado.split(" x ").map(Number)
    if (jogo.jogador1 === nome || jogo.jogador2 === nome) {
      total++
      if ((jogo.jogador1 === nome && g1 > g2) || (jogo.jogador2 === nome && g2 > g1)) {
        vitorias++
      } else if (g1 === g2) {
        empates++
      } else {
        derrotas++
      }
    }
  })
  
  const pontos = vitorias * 3 + empates
  const aproveitamento = total > 0 ? ((pontos / (total * 3)) * 100).toFixed(1) : "0.0"
  
  return { vitorias, derrotas, empates, total, aproveitamento }
  }
  
  function calcularRankingComAproveitamento() {
  const todosJogos = [...jogosDia1, ...jogosDia2, ...jogosDia3]
  const jogadores = {}
  
  todosJogos.forEach(jogo => {
    const [g1, g2] = jogo.resultado.split(" x ").map(Number)
    const j1 = jogo.jogador1
    const j2 = jogo.jogador2
  
    if (!jogadores[j1]) jogadores[j1] = { nome: j1, pontos: 0, jogos: [] }
    if (!jogadores[j2]) jogadores[j2] = { nome: j2, pontos: 0, jogos: [] }
  
    jogadores[j1].jogos.push(jogo)
    jogadores[j2].jogos.push(jogo)
  
    if (g1 > g2) jogadores[j1].pontos += 3
    else if (g2 > g1) jogadores[j2].pontos += 3
    else {
      jogadores[j1].pontos += 1
      jogadores[j2].pontos += 1
    }
  })
  
  return Object.values(jogadores)
    .map(j => {
      const stats = calcularEstatisticasCompletas(j.nome, todosJogos)
      return { ...j, ...stats }
    })
    .sort((a, b) => b.pontos - a.pontos || b.aproveitamento - a.aproveitamento)
  }
  
  function exibirRankingComAproveitamento() {
  const ranking = calcularRankingComAproveitamento()
  const tabela = document.querySelector("table tbody")
  tabela.innerHTML = ""
  
  ranking.forEach((entry, index) => {
    const tr = document.createElement("tr")
    tr.innerHTML = `
      <td>${index + 1}º</td>
      <td>${entry.nome}</td>
      <td>${entry.pontos}</td>
      <td>${entry.aproveitamento}%</td>
    `
    tabela.appendChild(tr)
  })
  }
  
  function estatisticasGeraisLiga() {
  const todosJogos = [...jogosDia1, ...jogosDia2, ...jogosDia3]
  const jogadores = {}
  let totalPartidas = todosJogos.length
  let empates = 0
  
  todosJogos.forEach(jogo => {
    const [g1, g2] = jogo.resultado.split(" x ").map(Number)
    if (g1 === g2) empates++
    jogadores[jogo.jogador1] = (jogadores[jogo.jogador1] || 0) + 1
    jogadores[jogo.jogador2] = (jogadores[jogo.jogador2] || 0) + 1
  })
  
  const totalJogadores = Object.keys(jogadores).length
  const maisAtivo = Object.entries(jogadores).sort((a, b) => b[1] - a[1])[0]
  
  const painel = document.createElement("div")
  painel.id = "painel-estatisticas-gerais"
  painel.innerHTML = `
    <h2>Estatísticas Gerais da Liga</h2>
    <p>Total de Partidas: ${totalPartidas}</p>
    `
  
  document.body.appendChild(painel)
  }
  
  document.addEventListener("DOMContentLoaded", () => {
    gerarTabelaPorRodada(jogosDia1, "tabelas-rodadas-dia1");
    gerarTabelaPorRodada(jogosDia2, "tabelas-rodadas-dia2");
    gerarTabelaPorRodada(jogosDia3, "tabelas-rodadas-dia3");
  
    exibirRankingComAproveitamento();
    estatisticasGeraisLiga();
  });
  
  
  
  